### mysql 面试题

1. 为什么 InnoDB 存储引擎选择使用 B+Tree 索引结构？
```text
1) 相对于二叉树，层级更少，搜索效率高
2) 对于 B-Tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针也跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低
3) 相对于 Hash 索引，B+Tree 支持范围匹配及排序操作
```

2. InnoDB 主键索引的 B+Tree 高度为多少？

```text
1) 假设一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB 的指针占用6个字节的空间，主键假设为bigint，占用字节数为8.
可得公式：n * 8 + (n + 1) * 6 = 16 * 1024，其中 8 表示 bigint 占用的字节数，n 表示当前节点存储的key的数量，(n + 1) 表示指针数量（比key多一个）。算出n约为1170。
2)
如果树的高度为2，那么他能存储的数据量大概为：1171 * 16 = 18736；
如果树的高度为3，那么他能存储的数据量大概为：1171 * 1171 * 16 = 21939856。
3)另外，如果有成千上万的数据，那么就要考虑分表，涉及运维篇知识。
```

3. 一张表，有四个字段（id, username, password, status），由于数据量大，需要对以下SQL语句进行优化，该如何进行才是最优方案：
```text
select id, username, password from tb_user where username='itcast';

解：给username和password字段建立联合索引，则不需要回表查询，直接覆盖索引。
```

4. 为什么每一次提交事务时，InnoDB所做的操作是刷新redo log buffer到redo log磁盘文件中，而不是直接将buffer pool中的脏页刷新到磁盘呢 ？

```text
在业务操作中，我们对数据的修改一般都是随机读写磁盘的，而不是顺序读写磁盘，随机读写磁盘的效率是很低的。 而redo log往磁盘文件中写入的数据是日志文件，日志文件是按顺序读写的，效率要远大于随机写。也就是上述的WAL机制，日志先行。
```